<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>পারখালী ভিলেজ অ্যাপ</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&family=Hind+Siliguri:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root {
            --primary: #2F80ED;
            --secondary: #56CCF2;
            --bg-color: #F7F9FC;
            --white: #ffffff;
            --text-dark: #1F2937;
            --text-gray: #9CA3AF;
            --shadow: 0 8px 30px rgba(0,0,0,0.08);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', 'Hind Siliguri', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: #eef2f5;
            height: 100vh;
            display: flex;
            justify-content: center;
            overflow: hidden; 
        }

        /* মোবাইল কন্টেইনার */
        .app-container {
            width: 100%;
            max-width: 480px;
            height: 100%;
            background: var(--bg-color);
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- অথেন্টিকেশন স্টাইল --- */
        #auth-view {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--white); z-index: 200;
            display: flex; flex-direction: column; justify-content: center; padding: 30px;
        }
        .input-group { position: relative; margin-bottom: 15px; }
        .input-group i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--primary); }
        .input-box { width: 100%; padding: 15px 15px 15px 45px; border: 1px solid #e1e1e1; border-radius: 15px; background: #f8f9fa; outline: none; transition: 0.3s; }
        .input-box:focus { border-color: var(--primary); background: white; box-shadow: 0 0 0 4px rgba(47, 128, 237, 0.1); }
        
        .btn-main { width: 100%; padding: 15px; background: linear-gradient(90deg, var(--primary), var(--secondary)); color: white; border: none; border-radius: 15px; font-weight: 600; font-size: 16px; margin-top: 10px; cursor: pointer; box-shadow: 0 5px 15px rgba(47, 128, 237, 0.3); }

        /* --- ড্যাশবোর্ড স্টাইল --- */
        #dashboard-view { display: none; height: 100%; flex-direction: column; }
        
        /* টপ বার */
        .top-bar { padding: 20px; background: var(--white); display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.03); z-index: 10; }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--primary); padding: 2px; }
        .user-avatar img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }

        /* স্ক্রলেবল কন্টেন্ট */
        .content-area { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; }
        
        /* সেকশন গুলো (ট্যাব) */
        .tab-section { display: none; animation: fadeIn 0.4s ease; }
        .tab-section.active { display: block; }

        /* সার্ভিস গ্রিড */
        .services-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; text-align: center; margin-top: 20px; }
        .service-item { display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .icon-box { width: 55px; height: 55px; border-radius: 18px; display: flex; align-items: center; justify-content: center; font-size: 24px; margin-bottom: 8px; box-shadow: var(--shadow); background: white; color: var(--primary); transition: 0.2s; }
        .service-item:active .icon-box { transform: scale(0.95); }

        /* --- বটম নেভিগেশন (চাহিদা অনুযায়ী) --- */
        .bottom-nav {
            position: absolute; bottom: 0; width: 100%;
            background: var(--white);
            height: 70px;
            display: flex; justify-content: space-around; align-items: center;
            border-radius: 25px 25px 0 0;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
            z-index: 50;
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #aaa; font-size: 10px; cursor: pointer; width: 20%; }
        .nav-item i { font-size: 20px; margin-bottom: 4px; transition: 0.3s; }
        .nav-item.active { color: var(--primary); }
        .nav-item.active i { transform: translateY(-3px); }

        /* সার্ভিস বাটন (বড় ও সার্কেল) */
        .nav-center-btn {
            width: 65px; height: 65px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            margin-top: -35px; /* উপরে উঠানো */
            box-shadow: 0 10px 20px rgba(47, 128, 237, 0.4);
            border: 5px solid var(--bg-color); /* সাদা বর্ডার */
            color: white; font-size: 24px; cursor: pointer;
            transition: 0.3s;
        }
        .nav-center-btn:active { transform: scale(0.95); }

        /* --- প্রোফাইল পেজ ডিজাইন --- */
        .profile-header {
            background: white; padding: 30px; border-radius: 20px; text-align: center; box-shadow: var(--shadow); position: relative;
        }
        .profile-img-lg {
            width: 100px; height: 100px; border-radius: 50%; border: 4px solid var(--bg-color); margin: 0 auto 15px; object-fit: cover; display: block;
        }
        .edit-btn {
            position: absolute; top: 20px; right: 20px; background: #f0f2f5; border: none; width: 35px; height: 35px; border-radius: 50%; color: var(--text-dark); cursor: pointer;
        }
        .profile-details { margin-top: 20px; background: white; border-radius: 20px; padding: 20px; box-shadow: var(--shadow); }
        .detail-row { display: flex; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #f0f0f0; padding-bottom: 10px; }
        .detail-row:last-child { border-bottom: none; }
        .detail-icon { width: 40px; height: 40px; background: #eef2ff; color: var(--primary); border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-right: 15px; }
        .detail-info { flex: 1; }
        .detail-label { font-size: 12px; color: var(--text-gray); }
        .detail-value { font-size: 15px; font-weight: 500; color: var(--text-dark); width: 100%; border: none; background: transparent; }
        .detail-value:disabled { color: var(--text-dark); background: transparent; }
        .detail-value:enabled { border-bottom: 2px solid var(--primary); background: #fff; padding: 5px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="app-container">
    
    <div id="auth-view">
        <div style="text-align: center; margin-bottom: 30px;">
            <h1 style="color: var(--primary);">স্বাগতম</h1>
            <p style="color: #888;">পারখালী ভিলেজ অ্যাপে লগইন করুন</p>
        </div>

        <div class="input-group">
            <i class="fas fa-envelope"></i>
            <input type="email" id="email" class="input-box" placeholder="ইমেইল">
        </div>
        <div class="input-group">
            <i class="fas fa-lock"></i>
            <input type="password" id="password" class="input-box" placeholder="পাসওয়ার্ড">
        </div>
        
        <button class="btn-main" onclick="handleLogin()">লগইন</button>
        <button class="btn-main" style="background: white; color: #333; border: 1px solid #ddd;" onclick="googleLogin()">
            <i class="fab fa-google"></i> Google
        </button>

        <p style="text-align: center; margin-top: 20px; font-size: 13px;">
            অ্যাকাউন্ট নেই? <span onclick="showProfileSetup()" style="color: var(--primary); font-weight: bold; cursor: pointer;">নতুন তৈরি করুন</span>
        </p>
    </div>

    <div id="profile-setup" style="display: none; position: absolute; top:0; left:0; width:100%; height:100%; background:white; z-index:201; padding: 30px; flex-direction: column; justify-content: center;">
        <h2 style="color: var(--primary); text-align: center; margin-bottom: 30px;">আপনার তথ্য দিন</h2>
        
        <div class="input-group">
            <i class="fas fa-user"></i>
            <input type="text" id="reg-name" class="input-box" placeholder="পুরো নাম">
        </div>
        <div class="input-group">
            <i class="fas fa-phone"></i>
            <input type="tel" id="reg-phone" class="input-box" placeholder="মোবাইল নম্বর">
        </div>
        <div class="input-group">
            <i class="fas fa-tint"></i>
            <select id="reg-blood" class="input-box">
                <option value="" disabled selected>রক্তের গ্রুপ নির্বাচন করুন</option>
                <option value="A+">A+</option>
                <option value="A-">A-</option>
                <option value="B+">B+</option>
                <option value="B-">B-</option>
                <option value="AB+">AB+</option>
                <option value="AB-">AB-</option>
                <option value="O+">O+</option>
                <option value="O-">O-</option>
            </select>
        </div>
        <div class="input-group">
            <i class="fas fa-map-marker-alt"></i>
            <input type="text" id="reg-address" class="input-box" placeholder="ঠিকানা (গ্রাম/পাড়া)">
        </div>

        <button class="btn-main" onclick="saveUserProfile()">তথ্য সেভ করুন</button>
    </div>

    <div id="dashboard-view">
        
        <div class="top-bar">
            <h3 style="color: var(--primary);">পারখালী</h3>
            <div class="user-avatar">
                <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Profile">
            </div>
        </div>

        <div class="content-area">
            
            <div id="home-sec" class="tab-section active">
                <div style="background: linear-gradient(135deg, #2F80ED, #56CCF2); padding: 25px; border-radius: 20px; color: white; margin-bottom: 20px;">
                    <h2>স্বাগতম!</h2>
                    <p>আপনার গ্রামের সকল সেবা এখানে।</p>
                </div>
                <h3>জনপ্রিয় সেবাসমূহ</h3>
                <div class="services-grid">
                    <div class="service-item"><div class="icon-box"><i class="fas fa-ambulance"></i></div><span>জরুরি</span></div>
                    <div class="service-item"><div class="icon-box"><i class="fas fa-tint"></i></div><span>রক্তদাতা</span></div>
                    <div class="service-item"><div class="icon-box"><i class="fas fa-shopping-basket"></i></div><span>বাজার</span></div>
                    <div class="service-item"><div class="icon-box"><i class="fas fa-mosque"></i></div><span>মসজিদ</span></div>
                </div>
            </div>

            <div id="people-sec" class="tab-section">
                <h3>গ্রামের জনগণ</h3>
                <p style="color: #888;">জনগণের তালিকা শীঘ্রই আসছে...</p>
                </div>

            <div id="service-sec" class="tab-section">
                <h3>সকল সেবাসমূহ</h3>
                <div class="services-grid">
                    <div class="service-item"><div class="icon-box"><i class="fas fa-ambulance"></i></div><span>অ্যাম্বুলেন্স</span></div>
                    <div class="service-item"><div class="icon-box"><i class="fas fa-user-shield"></i></div><span>পুলিশ</span></div>
                    <div class="service-item"><div class="icon-box"><i class="fas fa-fire"></i></div><span>ফায়ার</span></div>
                    <div class="service-item"><div class="icon-box"><i class="fas fa-bolt"></i></div><span>বিদ্যুৎ</span></div>
                    <div class="service-item"><div class="icon-box"><i class="fas fa-graduation-cap"></i></div><span>শিক্ষা</span></div>
                    <div class="service-item"><div class="icon-box"><i class="fas fa-bus"></i></div><span>পরিবহন</span></div>
                    <div class="service-item"><div class="icon-box"><i class="fas fa-landmark"></i></div><span>ইউনিয়ন</span></div>
                    <div class="service-item"><div class="icon-box"><i class="fas fa-briefcase-medical"></i></div><span>ডাক্তার</span></div>
                </div>
            </div>

            <div id="notice-sec" class="tab-section">
                <h3>নোটিশ বোর্ড</h3>
                <div style="background: white; padding: 15px; border-radius: 15px; margin-top: 10px; box-shadow: var(--shadow);">
                    <h4 style="color: var(--primary);">টিকাদান কর্মসূচি</h4>
                    <p style="font-size: 12px; color: #666;">আগামীকাল সকাল ১০টায় টিকা দেওয়া হবে।</p>
                </div>
            </div>

            <div id="profile-sec" class="tab-section">
                <div class="profile-header">
                    <button class="edit-btn" onclick="toggleEditProfile()"><i class="fas fa-pen"></i></button>
                    <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" class="profile-img-lg">
                    <h3 id="p-display-name">ব্যবহারকারী</h3>
                    <p style="color: #888; font-size: 13px;">সদস্য</p>
                </div>

                <div class="profile-details">
                    <div class="detail-row">
                        <div class="detail-icon"><i class="fas fa-user"></i></div>
                        <div class="detail-info">
                            <div class="detail-label">পুরো নাম</div>
                            <input type="text" id="p-name" class="detail-value" disabled>
                        </div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-icon"><i class="fas fa-phone-alt"></i></div>
                        <div class="detail-info">
                            <div class="detail-label">মোবাইল নম্বর</div>
                            <input type="tel" id="p-phone" class="detail-value" disabled>
                        </div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-icon"><i class="fas fa-tint"></i></div>
                        <div class="detail-info">
                            <div class="detail-label">রক্তের গ্রুপ</div>
                            <select id="p-blood" class="detail-value" disabled style="width: 100%; border:none;">
                                <option value="A+">A+</option> <option value="A-">A-</option>
                                <option value="B+">B+</option> <option value="B-">B-</option>
                                <option value="AB+">AB+</option> <option value="AB-">AB-</option>
                                <option value="O+">O+</option> <option value="O-">O-</option>
                            </select>
                        </div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-icon"><i class="fas fa-map-marker-alt"></i></div>
                        <div class="detail-info">
                            <div class="detail-label">ঠিকানা</div>
                            <input type="text" id="p-address" class="detail-value" disabled>
                        </div>
                    </div>

                    <button id="save-profile-btn" class="btn-main" onclick="saveProfileChanges()" style="display: none;">পরিবর্তন সেভ করুন</button>
                </div>
                
                <button onclick="logoutUser()" style="width: 100%; padding: 15px; margin-top: 20px; background: #ffebee; color: #ff4757; border: none; border-radius: 15px; font-weight: bold;">লগ আউট</button>
            </div>

        </div>

        <div class="bottom-nav">
            <div class="nav-item active" onclick="switchTab('home-sec', this)">
                <i class="fas fa-home"></i>
                <span>হোম</span>
            </div>
            <div class="nav-item" onclick="switchTab('people-sec', this)">
                <i class="fas fa-users"></i>
                <span>পিপল</span>
            </div>
            <div class="nav-center-btn" onclick="switchTab('service-sec', this)">
                <i class="fas fa-th-large"></i>
            </div>
            <div class="nav-item" onclick="switchTab('notice-sec', this)">
                <i class="fas fa-bullhorn"></i>
                <span>নোটিশ</span>
            </div>
            <div class="nav-item" onclick="switchTab('profile-sec', this)">
                <i class="fas fa-user"></i>
                <span>প্রোফাইল</span>
            </div>
        </div>

    </div>

</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAuqcDRrtuQi2tdWXA2E_UWyq7pCrGpoy4",
        authDomain: "parkhali-village.firebaseapp.com",
        projectId: "parkhali-village",
        storageBucket: "parkhali-village.firebasestorage.app",
        messagingSenderId: "645968583344",
        appId: "1:645968583344:web:89a049e6ffaba4af33b975",
        measurementId: "G-WD2LSS97KC"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const googleProvider = new GoogleAuthProvider();

    // অথেন্টিকেশন চেকার
    onAuthStateChanged(auth, async (user) => {
        if (user) {
            const userDoc = await getDoc(doc(db, "users", user.uid));
            if (userDoc.exists() && userDoc.data().phone) {
                loadDashboard(userDoc.data());
            } else {
                document.getElementById('auth-view').style.display = 'none';
                document.getElementById('profile-setup').style.display = 'flex';
            }
        } else {
            document.getElementById('auth-view').style.display = 'flex';
            document.getElementById('dashboard-view').style.display = 'none';
            document.getElementById('profile-setup').style.display = 'none';
        }
    });

    // গ্লোবাল ফাংশনস (উইন্ডোতে এক্সপোজ করা)
    window.showProfileSetup = () => {
        document.getElementById('auth-view').style.display = 'none';
        document.getElementById('profile-setup').style.display = 'flex';
    }

    window.googleLogin = async () => {
        try { await signInWithPopup(auth, googleProvider); } 
        catch (e) { Swal.fire('Error', e.message, 'error'); }
    }

    // প্রথমবার প্রোফাইল সেভ
    window.saveUserProfile = async () => {
        const user = auth.currentUser;
        const name = document.getElementById('reg-name').value;
        const phone = document.getElementById('reg-phone').value;
        const blood = document.getElementById('reg-blood').value;
        const address = document.getElementById('reg-address').value;

        if(!name || !phone || !blood) { Swal.fire('থামুন!', 'সব তথ্য পূরণ করুন', 'warning'); return; }

        await setDoc(doc(db, "users", user.uid), {
            name, phone, bloodGroup: blood, address, email: user.email
        }, { merge: true });

        Swal.fire({ title: 'সফল!', text: 'স্বাগতম আমাদের অ্যাপে', icon: 'success', timer: 1500, showConfirmButton: false })
            .then(() => loadDashboard({ name, phone, bloodGroup: blood, address }));
    }

    // ড্যাশবোর্ড লোড ও ডাটা সেট
    function loadDashboard(data) {
        document.getElementById('auth-view').style.display = 'none';
        document.getElementById('profile-setup').style.display = 'none';
        document.getElementById('dashboard-view').style.display = 'flex';
        
        // প্রোফাইল পেজের ডাটা আপডেট
        document.getElementById('p-display-name').innerText = data.name;
        document.getElementById('p-name').value = data.name;
        document.getElementById('p-phone').value = data.phone;
        document.getElementById('p-blood').value = data.bloodGroup;
        document.getElementById('p-address').value = data.address;
    }

    // ট্যাব সুইচিং (নেভিগেশন)
    window.switchTab = (sectionId, element) => {
        // সব সেকশন লুকানো
        document.querySelectorAll('.tab-section').forEach(el => el.classList.remove('active'));
        document.getElementById(sectionId).classList.add('active');
        
        // সব বাটন থেকে active ক্লাস সরানো
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        
        // সার্ভিস বাটন বাদে অন্য বাটনে active ক্লাস যোগ করা
        if (element.classList.contains('nav-item')) {
            element.classList.add('active');
        }
    }

    // প্রোফাইল এডিট টগল
    window.toggleEditProfile = () => {
        const inputs = document.querySelectorAll('.detail-value');
        const saveBtn = document.getElementById('save-profile-btn');
        let isDisabled = inputs[0].disabled;

        inputs.forEach(input => input.disabled = !isDisabled);
        
        if (isDisabled) {
            saveBtn.style.display = 'block';
            inputs[0].focus();
        } else {
            saveBtn.style.display = 'none';
        }
    }

    // প্রোফাইল আপডেট সেভ
    window.saveProfileChanges = async () => {
        const user = auth.currentUser;
        const updatedData = {
            name: document.getElementById('p-name').value,
            phone: document.getElementById('p-phone').value,
            bloodGroup: document.getElementById('p-blood').value,
            address: document.getElementById('p-address').value
        };

        try {
            await setDoc(doc(db, "users", user.uid), updatedData, { merge: true });
            Swal.fire('আপডেট হয়েছে!', 'আপনার প্রোফাইল সফলভাবে আপডেট হয়েছে।', 'success');
            window.toggleEditProfile(); // আবার ভিউ মোডে ফেরত
            document.getElementById('p-display-name').innerText = updatedData.name;
        } catch (e) {
            Swal.fire('ত্রুটি', 'আপডেট করা যায়নি', 'error');
        }
    }

    window.logoutUser = () => signOut(auth).then(() => location.reload());

</script>

</body>
</html>
