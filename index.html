<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MENTOR App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        :root { --primary: #4F46E5; --secondary: #818CF8; --bg: #F3F4F6; --text: #1F2937; --white: #ffffff; --danger: #EF4444; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: var(--bg); overflow: hidden; height: 100vh; width: 100vw; }

        /* --- UI COMPONENTS --- */
        #loading-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--white); z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .logo-container { position: relative; height: 100px; width: 300px; text-align: center; }
        .bird { font-size: 2rem; color: var(--primary); position: absolute; opacity: 0; }
        .bird.fly { animation: flyIn 2.5s forwards ease-in-out; }
        @keyframes flyIn { 0% { opacity: 0; transform: translate(-150px, -100px) scale(0.5); } 50% { opacity: 1; transform: translate(0px, -40px) scale(1); } 100% { opacity: 1; transform: translate(0px, -25px) scale(1); } }
        .app-name span { font-size: 2.5rem; font-weight: 800; color: var(--primary); opacity: 0; display: inline-block; transform: translateY(20px); }
        .app-name span.show { animation: letterPop 0.5s forwards; }
        @keyframes letterPop { to { opacity: 1; transform: translateY(0); } }

        /* Welcome Overlay */
        #welcome-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, var(--primary), var(--secondary)); z-index: 8888; display: none; flex-direction: column; justify-content: center; align-items: center; color: white; text-align: center; }
        .welcome-content { animation: popUp 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        .welcome-icon { font-size: 4rem; margin-bottom: 20px; background: rgba(255,255,255,0.2); width: 100px; height: 100px; line-height: 100px; border-radius: 50%; backdrop-filter: blur(5px); }
        @keyframes popUp { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* Auth */
        #auth-screen { display: none; position: relative; width: 100%; height: 100%; background: var(--white); overflow: hidden; }
        .auth-container { display: flex; width: 200%; height: 100%; transition: transform 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        .form-box { width: 50%; height: 100%; padding: 40px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        input { width: 100%; padding: 15px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; outline: none; }
        .btn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3); }

        /* Main App */
        #main-app { display: none; height: 100%; width: 100%; flex-direction: column; }
        .page { flex: 1; overflow-y: auto; padding: 20px; display: none; animation: fadeIn 0.4s; padding-bottom: 80px; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .bottom-nav { height: 70px; background: white; display: flex; justify-content: space-around; align-items: center; box-shadow: 0 -5px 20px rgba(0,0,0,0.05); position: absolute; bottom: 0; width: 100%; z-index: 100; }
        .nav-item { color: #9CA3AF; font-size: 1.2rem; cursor: pointer; display: flex; flex-direction: column; align-items: center; transition: 0.3s; }
        .nav-item.active { color: var(--primary); transform: translateY(-5px); }
        .nav-item span { font-size: 0.7rem; margin-top: 4px; }
        .nav-center { width: 60px; height: 60px; background: var(--primary); border-radius: 50%; display: flex; justify-content: center; align-items: center; color: white; font-size: 1.5rem; margin-top: -35px; box-shadow: 0 5px 15px rgba(79, 70, 229, 0.5); border: 5px solid var(--bg); }
        
        .card { background: white; padding: 15px; border-radius: 15px; margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); }
        .book-item { display: flex; align-items: center; gap: 15px; padding: 10px; border-bottom: 1px solid #eee; }
        .book-icon { width: 50px; height: 60px; background: var(--secondary); border-radius: 5px; display: flex; justify-content: center; align-items: center; color: white; }
        .exam-card { border-left: 5px solid var(--primary); }

        #admin-panel { display: none; background: white; height: 100%; width: 100%; position: absolute; top:0; z-index: 200; overflow-y: auto;}
        .student-card { background: #f9fafb; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--primary); }
        
        #toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 5px; padding: 16px; position: fixed; z-index: 1000; left: 50%; bottom: 100px; transform: translateX(-50%); }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 100px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 100px; opacity: 1;} to {bottom: 0; opacity: 0;} }
    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="logo-container">
            <i class="fas fa-dove bird" id="birdIcon"></i>
            <h1 class="app-name" id="appName"></h1>
        </div>
    </div>

    <div id="welcome-overlay">
        <div class="welcome-content">
            <div class="welcome-icon"><i class="fas fa-check"></i></div>
            <h1 id="welcomeOverlayText">Welcome!</h1>
            <p>Glad to have you here.</p>
        </div>
    </div>

    <div id="auth-screen">
        <div class="auth-container" id="authContainer">
            <div class="form-box">
                <h2 style="color:var(--primary); margin-bottom:20px;">Login</h2>
                <input type="email" id="loginEmail" placeholder="Email Address">
                <input type="password" id="loginPass" placeholder="Password">
                <button class="btn" onclick="handleLogin()">Login</button>
                <p style="margin-top:15px; font-size:0.9rem; color:grey;">Don't have an account? <b style="color:var(--primary); cursor:pointer;" onclick="toggleAuth('register')">Register</b></p>
            </div>
            <div class="form-box">
                <h2 style="color:var(--primary); margin-bottom:20px;">Register</h2>
                <input type="text" id="regName" placeholder="Full Name">
                <input type="email" id="regEmail" placeholder="Email Address">
                <input type="password" id="regPass" placeholder="Password">
                <button class="btn" onclick="handleRegister()">Sign Up</button>
                <p style="margin-top:15px; font-size:0.9rem; color:grey;">Already have an account? <b style="color:var(--primary); cursor:pointer;" onclick="toggleAuth('login')">Login</b></p>
            </div>
        </div>
    </div>

    <div id="main-app">
        <div id="home-page" class="page active">
            <div class="card" style="background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white;">
                <h2 id="welcomeName">Hello!</h2>
                <p>Welcome to Mentor Academy.</p>
            </div>
            <h3>Recent Updates</h3>
            <div class="card">
                <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
                    <i class="fas fa-bell" style="color:#F59E0B"></i> <b>New Exam Added</b>
                </div>
                <p style="font-size:0.9rem; color:grey;">Physics Chapter 5 exam is live now.</p>
            </div>
        </div>
        <div id="book-page" class="page"><h3>My Library</h3><div class="card"><div class="book-item"><div class="book-icon"><i class="fas fa-atom"></i></div><div><h4>HSC Physics</h4><small>Dr. Shahjahan</small></div></div></div></div>
        <div id="exam-page" class="page"><h3>Live Exams</h3><div class="card exam-card"><h4>Biology Daily Quiz</h4><button class="btn" style="padding:10px; font-size:0.9rem;">Start Exam</button></div></div>
        <div id="review-page" class="page"><h3>Give Review</h3><div class="card"><textarea style="width:100%; padding:10px;" rows="4" placeholder="Write review..."></textarea></div></div>
        <div id="profile-page" class="page">
            <div style="text-align:center; margin-top:20px;">
                <div style="width:100px; height:100px; background:#ddd; border-radius:50%; margin:0 auto; display:flex; justify-content:center; align-items:center; font-size:3rem; color:grey;"><i class="fas fa-user"></i></div>
                <h3 id="profileName" style="margin-top:15px;">User</h3>
                <p id="profileEmail" style="color:grey;">email@mail.com</p>
            </div>
            <div id="admin-btn-container" style="display:none; margin-top:20px;">
                <button class="btn" style="background:#374151;" onclick="openAdminPanel()">Admin Panel</button>
            </div>
            <button class="btn" style="background:var(--danger); margin-top:20px;" onclick="handleLogout()">Logout</button>
        </div>
        <div class="bottom-nav">
            <div class="nav-item active" onclick="navTo('home')"><i class="fas fa-home"></i><span>Home</span></div>
            <div class="nav-item" onclick="navTo('book')"><i class="fas fa-book-open"></i><span>Book</span></div>
            <div class="nav-center" onclick="navTo('exam')"><i class="fas fa-graduation-cap"></i></div>
            <div class="nav-item" onclick="navTo('review')"><i class="fas fa-star"></i><span>Review</span></div>
            <div class="nav-item" onclick="navTo('profile')"><i class="fas fa-user"></i><span>Profile</span></div>
        </div>
    </div>

    <div id="admin-panel">
        <div style="padding:20px; background:var(--text); color:white; display:flex; justify-content:space-between;">
            <h3>Admin Dashboard</h3> <i class="fas fa-times" onclick="document.getElementById('admin-panel').style.display='none'" style="cursor:pointer;"></i>
        </div>
        <div style="padding:20px;">
            <h4>Total: <span id="totalStudents">0</span></h4>
            <input type="text" id="searchBox" placeholder="Search..." onkeyup="filterStudents()" style="width:100%; padding:10px; margin:10px 0;">
            <div id="studentListContainer"></div>
        </div>
    </div>

    <div id="toast">Message</div>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>

    <script>
        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = { 
            apiKey: "AIzaSyCRWpnJC1Z3WCNUAyfjhw8KlKyJ03z3G2w", 
            authDomain: "mentor-ac742.firebaseapp.com", 
            projectId: "mentor-ac742", 
            storageBucket: "mentor-ac742.firebasestorage.app", 
            messagingSenderId: "271805714479", 
            appId: "1:271805714479:web:efc071e2021db4286db6da", 
            measurementId: "G-612FVVNZVK" 
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        const ADMIN_EMAIL = "mdwld2005@gmail.com";
        let isFirstLoad = true; // অ্যানিমেশন কন্ট্রোল ফ্ল্যাগ

        // --- 1. INITIALIZATION & ANIMATION ---
        document.addEventListener('DOMContentLoaded', () => {
            // Text Animation Setup
            const name = "MENTOR"; 
            const container = document.getElementById('appName');
            name.split('').forEach((l, i) => { 
                const s = document.createElement('span'); 
                s.textContent = l; 
                s.style.animationDelay = `${1.0 + (i*0.1)}s`; // Text comes after 1s
                container.appendChild(s); 
            });

            // Start Bird Animation immediately
            setTimeout(() => document.getElementById('birdIcon').classList.add('fly'), 100);
            
            // Start Text Animation
            setTimeout(() => document.querySelectorAll('.app-name span').forEach(s => s.classList.add('show')), 100);

            // AUTH LISTENER (With Delay for Animation)
            auth.onAuthStateChanged(user => {
                // আমরা ৩ সেকেন্ড অপেক্ষা করব অ্যানিমেশন শেষ হওয়ার জন্য
                setTimeout(() => {
                    document.getElementById('loading-screen').style.display = 'none'; // Hide Loading Screen
                    
                    if (user) {
                        // User Logged In
                        document.getElementById('auth-screen').style.display = 'none';
                        
                        // Welcome Overlay Animation (Only once per session)
                        if(isFirstLoad) { 
                            showWelcomeSequence(user); 
                            isFirstLoad = false; 
                        } else { 
                            document.getElementById('main-app').style.display = 'flex'; 
                        }
                        
                        loadUserData(user);
                    } else {
                        // User Not Logged In
                        document.getElementById('auth-screen').style.display = 'block';
                        document.getElementById('main-app').style.display = 'none';
                        isFirstLoad = true;
                    }
                }, 3000); // 3000ms = 3 Seconds fixed delay
            });
        });

        // --- 2. WELCOME SEQUENCE ---
        function showWelcomeSequence(user) {
            const overlay = document.getElementById('welcome-overlay');
            const welcomeText = document.getElementById('welcomeOverlayText');
            
            // নাম লোড হওয়ার আগে ডিফল্ট মেসেজ
            welcomeText.innerText = "Welcome Back!";
            
            overlay.style.display = 'flex';
            document.getElementById('main-app').style.display = 'none';
            
            setTimeout(() => { 
                overlay.style.display = 'none'; 
                document.getElementById('main-app').style.display = 'flex'; 
            }, 2500);
        }

        // --- 3. LOAD USER DATA ---
        function loadUserData(user) {
            document.getElementById('profileEmail').innerText = user.email;
            
            // Admin Check
            if(user.email === ADMIN_EMAIL) {
                document.getElementById('admin-btn-container').style.display = 'block';
            } else {
                document.getElementById('admin-btn-container').style.display = 'none';
            }

            db.collection('students').doc(user.uid).get().then(doc => {
                if(doc.exists) {
                    const data = doc.data();
                    document.getElementById('welcomeName').innerText = `Hello, ${data.name}!`;
                    document.getElementById('profileName').innerText = data.name;
                    document.getElementById('welcomeOverlayText').innerText = `Welcome, ${data.name.split(' ')[0]}!`;
                } else {
                    // Data missing (Old user or Admin)
                    const tempName = user.email.split('@')[0];
                    document.getElementById('welcomeName').innerText = `Hello, ${tempName}!`;
                    document.getElementById('profileName').innerText = tempName;
                }
            }).catch(error => console.log("Data Load Error:", error));
        }

        // --- 4. REGISTER (FIXED) ---
        function handleRegister() {
            const e = document.getElementById('regEmail').value;
            const p = document.getElementById('regPass').value;
            const n = document.getElementById('regName').value;

            if(!e||!p||!n) return showToast("Empty Fields");

            auth.createUserWithEmailAndPassword(e, p).then(cred => {
                // Save to Firestore
                return db.collection('students').doc(cred.user.uid).set({
                    name: n,
                    email: e,
                    joined: firebase.firestore.FieldValue.serverTimestamp()
                });
            }).then(() => {
                showToast("Account Created!");
                // Reload page to start fresh
                setTimeout(() => location.reload(), 1500); 
            }).catch(error => {
                console.error(error);
                if(error.code === 'permission-denied') {
                    showToast("Error: Database Rules Blocked.");
                    alert("Please enable Firestore Rules in Firebase Console!");
                } else {
                    showToast(error.message);
                }
            });
        }

        // --- 5. ADMIN PANEL (FIXED) ---
        let allStudents = [];
        
        function openAdminPanel() {
            document.getElementById('admin-panel').style.display = 'block';
            const list = document.getElementById('studentListContainer');
            list.innerHTML = '<p style="text-align:center; margin-top:20px;">Loading data...</p>';

            db.collection('students').get().then(snap => {
                allStudents = []; 
                snap.forEach(d => allStudents.push({id:d.id, ...d.data()}));
                
                document.getElementById('totalStudents').innerText = allStudents.length; 
                
                if(allStudents.length === 0) {
                    list.innerHTML = '<p style="text-align:center; color:grey; margin-top:20px;">No students found yet.<br>Try registering a new account.</p>';
                } else {
                    renderStudents(allStudents);
                }
            }).catch(err => {
                console.error("Admin Error:", err);
                list.innerHTML = '<p style="color:red; text-align:center;">Error loading data.<br>Check Console.</p>';
                if(err.code === 'permission-denied') alert("Admin Access Denied by Database Rules!");
            });
        }

        function renderStudents(list) {
            const con = document.getElementById('studentListContainer'); 
            con.innerHTML = '';
            list.forEach(s => { 
                con.innerHTML += `
                <div class="student-card">
                    <div><b>${s.name}</b><br><small>${s.email}</small></div>
                    <button onclick="deleteStudent('${s.id}')" style="background:var(--danger); color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer;">Del</button>
                </div>`; 
            });
        }

        function filterStudents() { 
            const q = document.getElementById('searchBox').value.toLowerCase(); 
            renderStudents(allStudents.filter(s => s.name.toLowerCase().includes(q))); 
        }

        function deleteStudent(id) { 
            if(confirm("Are you sure?")) {
                db.collection('students').doc(id).delete()
                    .then(() => {
                        showToast("Student Deleted");
                        openAdminPanel(); // Refresh list
                    })
                    .catch(err => showToast("Delete Failed"));
            }
        }

        // --- HELPER FUNCTIONS ---
        function toggleAuth(t) { document.getElementById('authContainer').style.transform = t==='register' ? "translateX(-50%)" : "translateX(0%)"; }
        function showToast(m) { const x = document.getElementById("toast"); x.textContent = m; x.className = "show"; setTimeout(()=>x.className=x.className.replace("show",""), 3000); }
        function handleLogin() { const e=document.getElementById('loginEmail').value, p=document.getElementById('loginPass').value; auth.signInWithEmailAndPassword(e, p).catch(e=>showToast("Login Failed: Check Email/Pass")); }
        function handleLogout() { auth.signOut().then(()=>location.reload()); }
        
        function navTo(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id + '-page').classList.add('active');
            if(id !== 'exam') event.currentTarget.classList.add('active');
        }
    </script>
</body>
</html>
