<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal AI Scanner</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
        }

        body {
            font-family: 'SolaimanLipi', 'Arial', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 15px;
            color: #333;
        }

        .container {
            background: var(--card-bg);
            max-width: 480px;
            margin: 0 auto;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: var(--primary-color);
            text-align: center;
            margin-top: 0;
            font-size: 24px;
        }

        /* Settings Area Style */
        .settings-box {
            background-color: #eef2ff;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid #c7d2fe;
        }

        .settings-title {
            font-size: 14px;
            font-weight: bold;
            color: #4338ca;
            margin-bottom: 10px;
            display: block;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-size: 14px;
            font-weight: 600;
            color: #475569;
        }

        select, input, button {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 15px;
            box-sizing: border-box;
            outline: none;
        }

        input:focus, select:focus {
            border-color: var(--primary-color);
            ring: 2px solid var(--primary-color);
        }

        button {
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
            border: none;
            cursor: pointer;
            transition: background 0.2s;
        }

        button:active { transform: scale(0.98); }
        button:disabled { background-color: #94a3b8; }

        /* Preview & Result */
        #imagePreview {
            width: 100%;
            height: 200px;
            object-fit: contain;
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            display: none;
            margin-bottom: 15px;
            background: #f1f5f9;
        }

        #resultArea {
            min-height: 150px;
            padding: 15px;
            background: #fff;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            white-space: pre-wrap;
            font-size: 15px;
            line-height: 1.6;
        }

        .status {
            text-align: center;
            font-size: 14px;
            color: #64748b;
            margin: 10px 0;
            display: none;
        }
        
        .download-btn {
            background-color: #16a34a;
            margin-top: 15px;
            display: none;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>üìÑ Universal Scanner</h2>

    <div class="settings-box">
        <span class="settings-title">‚öôÔ∏è ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ (API Setup)</span>
        
        <label>Select Provider</label>
        <select id="apiProvider" onchange="updateModelPlaceholder()">
            <option value="gemini">Google Gemini (Recommended)</option>
            <option value="openai">OpenAI (GPT-4o)</option>
            <option value="deepseek">DeepSeek AI</option>
        </select>

        <label>Paste Your API Key</label>
        <input type="password" id="apiKey" placeholder="Enter Gemini API Key here...">
    </div>

    <label>‡ßß. ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</label>
    <input type="file" id="imageInput" accept="image/*" onchange="previewImage()">
    <img id="imagePreview">

    <label>‡ß®. ‡¶ü‡ßá‡¶Æ‡¶™‡ßç‡¶≤‡ßá‡¶ü ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤</label>
    <select id="templateType">
        <option value="Simple Text">‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü (Simple)</option>
        <option value="Formal Application">‡¶Ö‡¶´‡¶ø‡¶∏‡¶ø‡ßü‡¶æ‡¶≤ ‡¶¶‡¶∞‡¶ñ‡¶æ‡¶∏‡ßç‡¶§ (Application)</option>
        <option value="Study Notes">‡¶™‡ßú‡¶æ‡¶∂‡ßã‡¶®‡¶æ‡¶∞ ‡¶®‡ßã‡¶ü (Study Notes)</option>
        <option value="Table Format">‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ ‡¶¨‡¶æ ‡¶õ‡¶ï (Table)</option>
    </select>

    <button onclick="processImage()" id="scanBtn">üîç ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    
    <div class="status" id="statusMsg">AI ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶õ‡ßá... ‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶® ‚è≥</div>

    <div id="resultArea" contenteditable="true" placeholder="Result will appear here..."></div>

    <button onclick="downloadFile()" class="download-btn" id="downloadBtn">üì• ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° (.txt)</button>
</div>

<script>
    let base64Image = "";

    // Provider ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ Model Name ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
    function updateModelPlaceholder() {
        const provider = document.getElementById('apiProvider').value;
        const keyInput = document.getElementById('apiKey');
        
        if(provider === 'gemini') {
            keyInput.placeholder = "Enter Google Gemini API Key...";
        } else if (provider === 'openai') {
            keyInput.placeholder = "Enter OpenAI API Key (requires proxy/backend)...";
        } else if (provider === 'deepseek') {
            keyInput.placeholder = "Enter DeepSeek API Key...";
        }
    }

    function previewImage() {
        const file = document.getElementById('imageInput').files[0];
        const preview = document.getElementById('imagePreview');
        
        if (file) {
            const reader = new FileReader();
            reader.onloadend = function() {
                preview.src = reader.result;
                preview.style.display = "block";
                base64Image = reader.result.split(',')[1]; // Remove data:image header
            }
            reader.readAsDataURL(file);
        }
    }

    async function processImage() {
        const apiKey = document.getElementById('apiKey').value.trim();
        const provider = document.getElementById('apiProvider').value;
        const template = document.getElementById('templateType').value;
        
        if (!apiKey) {
            alert("‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø API Key ‡¶¶‡¶ø‡¶®!");
            return;
        }
        if (!base64Image) {
            alert("‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®!");
            return;
        }

        // UI Update
        const btn = document.getElementById('scanBtn');
        const status = document.getElementById('statusMsg');
        const resultDiv = document.getElementById('resultArea');
        
        btn.disabled = true;
        status.style.display = "block";
        resultDiv.innerText = "";
        
        const systemPrompt = `
            Act as an expert OCR and Document formatter.
            Task: Extract text from the image perfectly.
            Language: Bengali and English mix.
            Format: Output strictly as '${template}'.
            Correction: Fix spelling errors automatically.
            Constraint: Do NOT add any conversational text like "Here is the text". Just give the content.
        `;

        try {
            let extractedText = "";

            if (provider === 'gemini') {
                // --- GOOGLE GEMINI LOGIC ---
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
                
                const response = await fetch(url, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: systemPrompt },
                                { inline_data: { mime_type: "image/jpeg", data: base64Image } }
                            ]
                        }]
                    })
                });
                
                const data = await response.json();
                if(data.error) throw new Error(data.error.message);
                extractedText = data.candidates[0].content.parts[0].text;

            } else if (provider === 'openai' || provider === 'deepseek') {
                // --- OPENAI / DEEPSEEK LOGIC ---
                // Note: These providers usually block browser calls (CORS).
                // This code follows their standard API format.
                
                let apiUrl = provider === 'openai' 
                    ? "https://api.openai.com/v1/chat/completions" 
                    : "https://api.deepseek.com/chat/completions";
                
                let modelName = provider === 'openai' ? "gpt-4o" : "deepseek-chat";

                const response = await fetch(apiUrl, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: modelName,
                        messages: [
                            { role: "system", content: systemPrompt },
                            { 
                                role: "user", 
                                content: [
                                    { type: "text", text: "Scan this image." },
                                    { type: "image_url", image_url: { url: `data:image/jpeg;base64,${base64Image}` } }
                                ]
                            }
                        ],
                        max_tokens: 2000
                    })
                });

                const data = await response.json();
                if(data.error) throw new Error(data.error.message);
                extractedText = data.choices[0].message.content;
            }

            resultDiv.innerText = extractedText;
            document.getElementById('downloadBtn').style.display = "block";

        } catch (error) {
            resultDiv.innerText = "Error: " + error.message + "\n\n(‡¶ü‡¶ø‡¶™‡¶∏: OpenAI/DeepSeek ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§ Gemini ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶ï‡ßÄ ‡¶¶‡¶ø‡¶®‡•§)";
            console.error(error);
        } finally {
            btn.disabled = false;
            status.style.display = "none";
        }
    }

    function downloadFile() {
        const text = document.getElementById('resultArea').innerText;
        const blob = new Blob([text], { type: "text/plain" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "scanned_document.txt";
        a.click();
    }
</script>

</body>
</html>
